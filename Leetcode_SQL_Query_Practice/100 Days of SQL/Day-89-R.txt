/* Section 92
*/


CREATE TABLE city_population (
    state VARCHAR(50),
    city VARCHAR(50),
    population INT
);

-- Insert the data
INSERT INTO city_population (state, city, population) VALUES ('haryana', 'ambala', 100);
INSERT INTO city_population (state, city, population) VALUES ('haryana', 'panipat', 200);
INSERT INTO city_population (state, city, population) VALUES ('haryana', 'gurgaon', 300);
INSERT INTO city_population (state, city, population) VALUES ('punjab', 'amritsar', 150);
INSERT INTO city_population (state, city, population) VALUES ('punjab', 'ludhiana', 400);
INSERT INTO city_population (state, city, population) VALUES ('punjab', 'jalandhar', 250);
INSERT INTO city_population (state, city, population) VALUES ('maharashtra', 'mumbai', 1000);
INSERT INTO city_population (state, city, population) VALUES ('maharashtra', 'pune', 600);
INSERT INTO city_population (state, city, population) VALUES ('maharashtra', 'nagpur', 300);
INSERT INTO city_population (state, city, population) VALUES ('karnataka', 'bangalore', 900);
INSERT INTO city_population (state, city, population) VALUES ('karnataka', 'mysore', 400);
INSERT INTO city_population (state, city, population) VALUES ('karnataka', 'mangalore', 200);


-- One method
select state,max(case when highest_population_rnk=1 then city else null end) as highest_populated_city, 
max(case when lowest_population_rnk=1 then city else null end) as lowest_populated_city

from

(select *, row_number() over(partition by state order by population desc) as highest_population_rnk,
row_number() over(partition by state order by population) as lowest_population_rnk
from city_population) A
group by state;


-- Another method
select state,max(case when population=highest_population then city else null end) as highest_populated_city, 
max(case when population=lowest_population then city else null end) as lowest_populated_city

from

(select *, max(population) over(partition by state) as highest_population,
min(population) over(partition by state) as lowest_population
from city_population) A
group by state;
